---
import { getCollection } from "astro:content";
import Experience from "./Experience.astro";

const experiences = await getCollection("experience");

const categories = [
  { id: "work", name: "Work" },
  { id: "school", name: "Education" },
  { id: "baja", name: "Baja SAE" },
];

const sortDates = (a, b) =>
  Date.parse(b.data.date_end) - Date.parse(a.data.date_end);
---

<div id="tab-wrapper" x-data="{tab: 0}" class="border-2 rounded my-1">
  <!-- tabs navigation -->
  <div
    class="flex m-0 cursor-pointer overflow-x-scroll no-scrollbar border-b-2 items-center"
  >
    {
      categories.map((category, index) => (
        <div
          x-bind:class={`{'invert': tab === ${index}}`}
          x-on:click={`tab = ${index}`}
          class="py-2 px-4 flex-grow mt-0 text-lg text-center"
        >
          {category.name}
        </div>
      ))
    }
  </div>

  <!-- tabs content -->
  {
    categories.map((category, index) => (
      <div
        x-show={`tab === ${index}`}
        class="p-5 prose prose-invert prose-sm max-w-none prose-headings:my-0 prose-li:my-0 prose-p:my-0 prose-ul:my-0 prose-h2:mt-4 prose-em:font-normal"
      >
        {
          experiences
            .filter(experience => experience.data.category === category.id)
            .sort(sortDates)
            .map(experience => <Experience {experience} />)
        }
      </div>
    ))
  }
</div>
